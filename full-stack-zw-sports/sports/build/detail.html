<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>训练馆详情</title><link rel="stylesheet" href="css/reset-dd71e4cbba.css"><script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="https://cdn.bootcss.com/vue/2.2.6/vue.min.js"></script><script src="js/common-9de3ecab4b.js"></script></head><body><style>.ctn{padding:0}.poster{height:12rem;width:100%;overflow:hidden}.poster ul{position:relative;transition:all .3s}.poster ul li{float:left}.poster ul li img{width:100%;height:12rem}.detail ul.tab{overflow:hidden}.detail .tab li{float:left;width:33.3333%;text-align:center;padding:.2rem;font-size:1.2rem}.detail .tab li.cur{color:#93d0ff}.detail .tab li img{width:3rem;display:block;margin:0 auto}.detail ul.main{width:100%}.detail ul.main>li{width:100%;float:left;font-size:1.2rem;line-height:1.1;color:#666;word-break:break-all;margin-bottom:4rem}.detail ul.main>li img{max-width:100%}.detail ul.main>li.de img{height:auto!important}.detail ul.main li .title{font-size:1.5rem;color:#333;margin-top:1rem;line-height:1.6}.judge{padding:.5rem 0;border-bottom:1px solid #efefef;overflow:hidden;font-size:1.2rem;color:#333}.judge img{float:left;display:block;width:4rem;height:4rem;background:#efefef;border-radius:50%;margin-right:1rem}.judge .right{float:left;display:block;width:20rem}.judge .right .name{float:left}.judge .right .time{float:right}.judge .right .text{font-size:1rem;line-height:1.5rem;color:#666;word-break:break-all;margin-top:2rem}.show{display:block}.hide{display:none}.upload{width:15rem;height:3.4rem;line-height:3.4rem;font-size:1.4rem;text-align:center;background:#93d0ff;color:#fff;position:fixed;width:100%;bottom:0;left:0}#upfile{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0}ul.img-list{background:#000;overflow:hidden}ul.img-list li{width:33.33333%;border:3px solid #000;height:7rem;float:left}ul.img-list li img{width:100%;height:100%}.add-judge{text-align:center;font-size:1.2rem;color:#666}.add-judge textarea{font-size:1.2rem;width:18rem;height:2.4rem;line-height:1;border:1px solid #93d0ff}.add-judge span{position:relative;top:-.7rem;background:#93d0ff;color:#fff;padding:.5rem 1.8rem;border-radius:.5rem;margin-left:1rem}</style><div id="el"><div class="top">{{name}}</div><div class="poster"><ul :style="{ overflow: 'hidden', width: posterlists.length*100+'%', left: posterLeft+'px' }"><li v-for="item in posterlists" :style="{ width: 100/(posterlists.length)+'%' }"><img :src="'http://www.zhengwusport.com'+item.image" alt=""></li></ul></div><div class="ctn"><div class="detail" style="padding-bottom:4.5rem"><ul class="tab"><li :class="cur == 0 ? 'cur':''" @click="cur=0"><img src="img/d1.png">课程介绍</li><li :class="cur == 1 ? 'cur':''" @click="cur=1"><img src="img/d3.png">精彩瞬间</li><li :class="cur == 2 ? 'cur':''" @click="cur=2"><img src="img/d2.png">课程评价</li></ul><div style="margin:.5rem 0 0;background:#eee;clear:both;height:1rem"></div><ul class="main"><li :class="cur == 0 ? 'show' : 'hide'" style="padding-top:1rem" class="de"><div v-html="detail"></div><div class="fixed-btm"><a :href="'enroll.html?id='+id+'&name='+name" class="fl" @click="enroll(id)">立即报名</a> <a :href="'tel:'+mobile" class="fr">咨询</a></div></li><li :class="cur == 1 ? 'show' : 'hide'"><div class="upload">上传图片 <input type="file" id="upfile"></div><ul class="img-list" v-if="imglists.length>0"><li v-for="item in imglists"><img :src="'http://www.zhengwusport.com'+item.addr" @click="viewImg('http://www.zhengwusport.com'+item.addr)" alt=""></li></ul><div class="no-list" v-if="imglists.length==0">暂无图片</div><div class="no-list" v-if="imglists.length>0 && isImgMore">没有更多了</div></li><li :class="cur == 2 ? 'show' : 'hide'"><div class="add-judge"><textarea v-model="newJudge"></textarea><span @click="addJudge">评价</span></div><div class="judge" v-for="item in judgeLists" v-if="judgeLists.length>0"><div class="right"><div class="name">{{item.name}}</div><div class="time">{{item.time}}</div><div class="text">{{item.content}}</div></div></div><div class="no-list" v-if="judgeLists.length==0">暂无评价</div><div class="no-list" v-if="judgeLists.length>0 && isJudgeMore">没有更多了</div></li></ul></div></div></div><script>function baseToBlob(e,t){var i=new FileReader;i.onload=function(){function e(){var e=compress(i,.1);t(dataURLtoBlob(e))}var i=new Image;i.src=this.result,i.complete?e():i.onload=e},i.readAsDataURL(e)}function compress(e,t){var i,n=document.createElement("canvas"),a=n.getContext("2d"),o=document.createElement("canvas"),g=o.getContext("2d"),s=e.width,l=e.height;(i=s*l/4e6)>1?(s/=i=Math.sqrt(i),l/=i):i=1,n.width=s,n.height=l,a.fillStyle="#fff",a.fillRect(0,0,n.width,n.height);var d;if((d=s*l/1e6)>1){var r=~~(s/(d=~~(Math.sqrt(d)+1))),u=~~(l/d);o.width=r,o.height=u;for(var c=0;c<d;c++)for(var m=0;m<d;m++)g.drawImage(e,c*r*i,m*u*i,r*i,u*i,0,0,r,u),a.drawImage(o,c*r,m*u,r,u)}else a.drawImage(e,0,0,s,l);var h=n.toDataURL("image/jpeg",t);return o.width=o.height=n.width=n.height=0,h}function dataURLtoBlob(e){for(var t=e.split(","),i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),a=n.length,o=new Uint8Array(a);a--;)o[a]=n.charCodeAt(a);return new Blob([o],{type:i})}$(document).on("click","#viewImg",function(){$("#viewImg").remove()}),new Vue({el:"#el",data:{name:null,mobile:"",isJudgeMore:!0,judgePage:1,judgeDone:!0,isImgMore:!0,imgPage:1,imgDone:!0,id:null,cur:0,judgeLists:[],posterlists:[],posterLeft:0,imglists:[],detail:"",newJudge:""},mounted:function(){var e=this;this.id=location.href.split("id=")[1].split("&")[0],this.detail=decodeURI(location.href.split("remarks=")[1].split("&")[0]),this.name=decodeURI(location.href.split("name=")[1].split("&")[0]),this.mobile=decodeURI(location.href.split("mobile=")[1].split("&")[0]),e.imgDone=!1,e._ajaxData("get","/zhengwu/image",{trainId:e.id,pageNo:1},function(t){e.imglists=t.list||[],e.imgDone=!0}),e.judgeDone=!1,e._ajaxData("get","/zhengwu/comment/list",{trainId:e.id,pageNo:1},function(t){e.judgeLists=t.list||[],e.judgeDone=!0}),e._ajaxData("get","/zhengwu/lunbo/train",{trainId:e.id},function(t){e.posterlists=t.list||[];var i=0,n=!0,a=document.documentElement.clientWidth||document.body.clientWidth;e.posterlists.length>1&&setInterval(function(){i==e.posterlists.length-1?n=!1:0==i&&(n=!0),n?(i++,e.posterLeft-=a):(i--,e.posterLeft+=a)},2e3)}),document.getElementById("upfile").onchange=function(){var t=document.getElementById("upfile").files[0],i=new FormData;i.append("upfile",t),i.append("trainId",e.id),$.ajax({type:"POST",url:"http://www.zhengwusport.com/zhengwu/image/upload",data:i,contentType:!1,processData:!1,success:function(t){alert("上传成功~"),e._ajaxData("get","/zhengwu/image",{trainId:e.id,pageNo:1},function(t){t.list.length>0&&(e.imglists=t.list),e.imgDone=!0,t.list.length<t.pageSize&&(e.isImgMore=!1),e.imglists.length>=t.count&&(e.isImgMore=!1)})},error:function(e){alert("上传出错"+JSON.stringify(e))}})},$(window).scroll(function(){$(document).height()-$(document).scrollTop()-$(window).height()==0&&(console.log("到底啦"),1==e.cur&&e.isImgMore&&e.imgDone&&(e.imgPage++,e.imgDone=!1,e._ajaxData("get","/zhengwu/image",{trainId:e.id,pageNo:e.imgPage},function(t){t.list.length>0&&(e.imglists=e.imglists.concat(t.list)),e.imgDone=!0,t.list.length<t.pageSize&&(e.isImgMore=!1),e.imglists.length>=t.count&&(e.isImgMore=!1)})),2==e.cur&&e.isJudgeMore&&e.judgeDone&&(e.judgePage++,e.judgeDone=!1,e._ajaxData("get","/zhengwu/comment/list",{trainId:e.id,pageNo:e.judgePage},function(t){t.list.length>0&&(e.judgeLists=e.judgeLists.concat(t.list)),e.judgeDone=!0,t.list.length<t.pageSize&&(e.isJudgeMore=!1),e.judgeLists.length>=t.count&&(e.isJudgeMore=!1)})))})},methods:{enroll:function(){},addJudge:function(){if(""!=this.newJudge.trim()){var e=this;localStorage.zwUserId?this._ajaxData("post","/zhengwu/comment",{trainId:this.id,userinfoId:localStorage.zwUserId,content:this.newJudge.trim()},function(t){alert("评论成功~"),e.newJudge="",e._ajaxData("get","/zhengwu/comment/list",{trainId:e.id,pageNo:1},function(t){e.judgeLists=t.list||[],e.judgeDone=!0})}):alert("授权处理开发中，请稍候，或者现在随便去报名个体验课然后再来评论")}else alert("评价内容不能为空")},viewImg:function(e){var t='<div id="viewImg" style="position:fixed;width:100%;height:100%;top:0;left:0;background:rgba(0,0,0,0.5);"><img src='+e+' style="max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform: translate(-50%, -50%);"></div>';$("body").append(t)}}})</script></body></html>