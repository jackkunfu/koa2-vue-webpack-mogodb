<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>demo</title>
	<link rel="stylesheet" type="text/css" href="css/reset.css"/>

	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="js/vue.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
</head>
<body>

	<style>
		.row{
			overflow: hidden;
			padding: 0.5rem;
		}
		.row::after{
			clear: both;
		}

		.form .row .fl,
		.form .row .fr{
			float: left;
			font-size: 1.3rem;
			line-height: 3rem;
		}

		.form .row .fl{
			width: 40%;
			padding-left: 1rem;
		}

		.form .row .fr{
			width: 60%;
		}

		.form .row .fr textarea,
		.form .row .fr select,
		.form .row .fr input{
			font-size: 1rem;
			padding-left: 0.5rem;
			width: 100%;
			height: 3rem;
			line-height: 3rem;
			border: 1px solid #eee;
		}

		select option{
			font-size: 1.5rem;
			line-height: 1;
		}

		.form .row .fr textarea{
			height: 10rem;
		}

		.form .row .fr input[type=radio]{
			margin-left: 1rem;
			width: 1rem;
		}

	</style>

	<div class="top">
		我要报名
	</div>

	<div class="form ctn">
		<div class="row">
			<div class="fl">课程类型</div>
			<div class="fr">
				<div class="select" @click="selectOpen=!selectOpen;">
					<span>{{item.classType}}</span>
					<ul v-show="selectOpen">
						<li v-for="cl in item.classes" @click="item.pay = cl.pay; item.classType= cl.name;">{{cl.name}}</li>
						<li @click="item.pay = 0; item.classType= cl.name;isTry=true;">体验课</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="row" v-show="!isTry">
			<div class="fl">课程时间</div>
			<div class="fr">
				<div class="select" @click="selectOpen=!selectOpen;">
					<span>{{item.classType}}</span>
					<ul v-show="selectOpen">
						<li v-for="cl in item.times" @click="item.pay = cl.pay; item.classType= cl.name;">{{cl.name}}</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="row" v-show="!isTry">
			<div class="fl">课程频次</div>
			<div class="fr">
				<div class="select" @click="selectOpen=!selectOpen;">
					<span>{{item.classType}}</span>
					<ul v-show="selectOpen">
						<li v-for="cl in item.classes" @click="item.pay = cl.pay; item.classType= cl.name;">{{cl.name}}</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="fl">学员姓名</div>
			<div class="fr">
				<input type="text" v-model="item.name"/>
			</div>
		</div>

		<div class="row">
			<div class="fl">性别</div>
			<div class="fr">
				<input type="radio" name="sex" value="0" v-model="item.sex"/><span style="position: relative;top:-1.5rem;">男</span>
				<input type="radio" name="sex" value="1" v-model="item.sex"/><span style="position: relative;top:-1.5rem;">女</span>
			</div>
		</div>

		<div class="row">
			<div class="fl">生日</div>
			<div class="fr">
				<input type="text" v-model="item.birthVal" placeholder="-符号隔开： 2017-01-01"/>
			</div>
		</div>

		<div class="row">
			<div class="fl">地址</div>
			<div class="fr">
				<input type="text" v-model="item.address"/>
			</div>
		</div>

		<div class="row">
			<div class="fl">父母姓名</div>
			<div class="fr">
				<input type="text" v-model="item.familyName"/>
			</div>
		</div>

		<div class="row">
			<div class="fl">父母手机</div>
			<div class="fr">
				<input type="text" v-model="item.mobile"/>
			</div>
		</div>

		<div class="row">
			<div class="fl">备注</div>
			<div class="fr">
				<textarea type="text" v-model="item.desc"></textarea>
			</div>
		</div>

		<div class="fixed-btm">
			<div class="fl">费用合计
				<span style="color: red;margin: 0 10px;">
					<span v-if="item.classType==0">{{item.pay0}}</span>
					<span v-if="item.classType==1">{{item.pay1}}</span>
					<span v-if="item.classType==2">{{item.pay2}}</span>
				</span>元
			</div>
			<div class="fr" @click="pay">报名</div>
		</div>
	</div>

	<script>
	Vue.config.devtools = true;

		new Vue({
			el: '.ctn',
			data: {
				isTry: false,  // 是否是体验课
				item: {
					classType: '',
					name: '',
					sex: '',
					birthVal: '',
					address: '',
					familyName: '',
					mobile: '',
					desc: '',
					pay1: 100,
					pay2: 200,
					pay3: 300,
					trainId: null
				},
				selectOpen: false
			},
			mounted: function(){
				this.item.trainId = location.href.split('id=')[1];

				var _this = this;
				this.$nextTick(function () {})

			},
			methods: {
				pay(){
					var _this = this;
					// if(!localStorage.zwUserId){
					// 	if(confirm('还没登陆，是否去登陆？')){
					// 		location.href = "/login.html"
					// 	}
					// }
					// alert(this.item.name)
					if(!this.item.classType || this.item.classType == 0){
						alert('课程类型没选~');
						return;
					}
					if(!this.item.name || this.item.name.trim() == ''){
						alert('姓名没填~');
						return;
					}
					if(!this.item.sex || this.item.sex.trim() == ''){
						alert('性别没选~');
						return;
					}
					if(!this.item.birthVal || this.item.birthVal.trim() == ''){
						alert('生日没填~');
						return;
					}
					if(!this.item.address || this.item.address.trim() == ''){
						alert('地址没填~');
						return;
					}
					if(!this.item.familyName || this.item.familyName.trim() == ''){
						alert('家长姓名没填~');
						return;
					}
					if(!this.item.mobile || this.item.mobile.trim() == ''){
						alert('手机没选~');
						return;
					}

					if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(this.item.mobile))){
						alert('手机号格式不对~');
						return;
					}
					this.item.pay = this.item['pay'+(this.item.classType)];
					// this.item.birth = new Date(this.item.birthVal).getTime();
					this.item.birth = this.item.birthVal;
					this._ajaxData('post', '/zhengwu/user', this.item, function(data){
						alert('报名成功，接入微信支付中，')
						if(true) location.href = ''
					})
				}
			}
		})

	</script>


</body>
</html>
